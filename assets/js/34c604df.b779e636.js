"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3297],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(n),g=i,m=c["".concat(l,".").concat(g)]||c[g]||p[g]||r;return n?a.createElement(m,o(o({ref:t},u),{},{components:n})):a.createElement(m,o({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},7385:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}const r=e=>{let{title:t,titleId:n,...r}=e;return a.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16","aria-labelledby":n},r),t?a.createElement("title",{id:n},t):null,a.createElement("path",{style:{stroke:"none",fillRule:"nonzero",fill:"#9e80b5",fillOpacity:1},d:"M3 14a.947.947 0 0 1-.7-.3.947.947 0 0 1-.3-.7V3c0-.266.098-.5.3-.7.2-.202.434-.3.7-.3h4.652v1H3v10h10V8.348h1V13c0 .266-.098.5-.3.7-.2.202-.434.3-.7.3Zm3.367-3.652-.699-.715L12.301 3H8.652V2H14v5.348h-1V3.715Zm0 0"}))}},6101:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=n(7462),i=(n(7294),n(3905)),r=n(7385);const o={title:"Gradle Managed Devices Support",description:"Gradle Managed Devices Support in Android Testify",slug:"gradle-managed-device",authors:[{name:"Daniel Jette",title:"Core Contributor to Android Testify",url:"https://github.com/DanielJette",image_url:"https://github.com/DanielJette.png"}],tags:["gradle managed device","customization"],hide_table_of_contents:!1},s="Announcing New Feature: Gradle Managed Devices Support in Android Testify",l={permalink:"/android-testify/blog/gradle-managed-device",editUrl:"https://github.com/ndtp/android-testify/tree/issue-12/docusaurus/docs/blog/2023-09-23-gradle-managed-device.md",source:"@site/blog/2023-09-23-gradle-managed-device.md",title:"Gradle Managed Devices Support",description:"Gradle Managed Devices Support in Android Testify",date:"2023-09-23T00:00:00.000Z",formattedDate:"September 23, 2023",tags:[{label:"gradle managed device",permalink:"/android-testify/blog/tags/gradle-managed-device"},{label:"customization",permalink:"/android-testify/blog/tags/customization"}],readingTime:3.68,truncated:!1,authors:[{name:"Daniel Jette",title:"Core Contributor to Android Testify",url:"https://github.com/DanielJette",image_url:"https://github.com/DanielJette.png",imageURL:"https://github.com/DanielJette.png"}],frontMatter:{title:"Gradle Managed Devices Support",description:"Gradle Managed Devices Support in Android Testify",slug:"gradle-managed-device",authors:[{name:"Daniel Jette",title:"Core Contributor to Android Testify",url:"https://github.com/DanielJette",image_url:"https://github.com/DanielJette.png",imageURL:"https://github.com/DanielJette.png"}],tags:["gradle managed device","customization"],hide_table_of_contents:!1},prevItem:{title:"Testify Embraces Semantic Versioning",permalink:"/android-testify/blog/semantic-versioning"},nextItem:{title:"Customizing Screenshot Instrumentation Annotation",permalink:"/android-testify/blog/custom-annotations"}},d={authorsImageUrls:[void 0]},u=[{value:"Understanding Gradle Managed Devices",id:"understanding-gradle-managed-devices",level:3},{value:"Why Use Gradle Managed Devices?",id:"why-use-gradle-managed-devices",level:3},{value:"Using Gradle Managed Devices with Android Testify",id:"using-gradle-managed-devices-with-android-testify",level:3},{value:"Running Screenshot Tests",id:"running-screenshot-tests",level:3},{value:"Updating Baselines",id:"updating-baselines",level:3},{value:"Happy Testing",id:"happy-testing",level:2}],c={toc:u},p="wrapper";function g(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"We're thrilled to unveil an exciting addition to Android Testify, our open source project revolutionizing the way you conduct screenshot tests for your Android applications. Introducing ",(0,i.kt)("strong",{parentName:"p"},"Gradle Managed Devices Support"),", a feature designed to streamline your testing process and enhance the overall efficiency of your UI testing suite."),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"understanding-gradle-managed-devices"},"Understanding Gradle Managed Devices"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/studio/test/gradle-managed-devices"},"Gradle Managed Devices ",(0,i.kt)(r.Z,{mdxType:"OpenNew"}))," is a powerful capability that allows you to manage and control Android emulators directly through Gradle. This means you can easily set up and configure virtual devices for testing directly within your build scripts, automating the process and ensuring a consistent testing environment across various projects and team members."),(0,i.kt)("h3",{id:"why-use-gradle-managed-devices"},"Why Use Gradle Managed Devices?"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Consistency and Reproducibility:")," By defining the emulator configurations in the Gradle build scripts, you ensure that all team members have access to the same testing setups. This promotes consistent testing across different development environments.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Simplified Configuration:")," Managing emulators directly through Gradle simplifies the setup process for testing different resolutions, orientations, API versions, and languages. Developers can easily switch between configurations without manually adjusting emulator settings.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Integration with Continuous Integration:")," Gradle Managed Devices seamlessly integrates with most Continuous Integration (CI) services, allowing for automated and reliable UI testing as part of your CI/CD pipeline."))),(0,i.kt)("p",null,"Now, let's delve into how you can leverage this new feature in Android Testify to optimize your UI testing workflow."),(0,i.kt)("h3",{id:"using-gradle-managed-devices-with-android-testify"},"Using Gradle Managed Devices with Android Testify"),(0,i.kt)("p",null,"To take advantage of Gradle Managed Devices support in Android Testify, follow these simple steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Upgrade Testify to Beta 4:")," Update the classpath for the Testify plugin to version 2.0.0-beta04.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},'buildscript {\n    repositories {\n        mavenCentral()\n    }\n    dependencies {\n        classpath "dev.testify:plugin:2.0.0-beta04"\n    }\n}\n')),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Update Your Gradle Build File:")," In your project's ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")," file, ensure you have the necessary dependencies and configurations to enable Gradle Managed Devices support.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},'android {\n  ...\n  testOptions {\n    managedDevices {\n      devices {\n        pixel2api30 (ManagedVirtualDevice) {\n          // Use device profiles you typically see in Android Studio.\n          device = "Pixel 2"\n          // Use only API levels 27 and higher.\n          apiLevel = 30\n          // To include Google services, use "google".\n          systemImageSource = "aosp"\n        }\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"Customize the ",(0,i.kt)("inlineCode",{parentName:"p"},"devices")," block according to your specific testing needs, specifying the device name, API version, locale, and orientation."),(0,i.kt)("p",null,"In addition, enable ",(0,i.kt)("inlineCode",{parentName:"p"},"TestStorageService")," to receive screenshots after test execution:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},'android {\n    defaultConfig {\n        testInstrumentationRunnerArguments useTestStorageService: "true"\n    }\n}\n\ndependencies {\n    androidTestUtil("androidx.test.services:test-services:1.4.2")\n}\n')),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Configure the Testify Library:")," To instruct Testify to use Test Storage for storing screenshots and diffs, modify the Testify plugin configuration in your ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")," file.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"testify {\n  useTestStorage true\n}\n")),(0,i.kt)("h3",{id:"running-screenshot-tests"},"Running Screenshot Tests"),(0,i.kt)("p",null,"To perform screenshot test verification using the Gradle Managed Devices you configured, use the following command. ",(0,i.kt)("inlineCode",{parentName:"p"},"device-name")," is the name of the device you configured in your Gradle build script (such as ",(0,i.kt)("inlineCode",{parentName:"p"},"pixel2api30"),"), and ",(0,i.kt)("inlineCode",{parentName:"p"},"BuildVariant")," is the build variant of your app you want to test (such as ",(0,i.kt)("inlineCode",{parentName:"p"},"Debug"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"./gradlew device-nameBuildVariantAndroidTest\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Due to using Gradle Managed Devices using Test Storage to save screenshots, the ",(0,i.kt)("inlineCode",{parentName:"p"},"screenshotPull")," task is unavailable. After execution, you can find any recorded screenshot in your module's ",(0,i.kt)("inlineCode",{parentName:"p"},"build/outputs/managed_device_android_test_additional_output/")," folder."))),(0,i.kt)("h3",{id:"updating-baselines"},"Updating Baselines"),(0,i.kt)("p",null,"Since Gradle Managed Devices requires the use of their specific Gradle tasks, we cannot use the normal ",(0,i.kt)("inlineCode",{parentName:"p"},"screenshotRecord")," task to udate our baselines. To generate a new baseline, you now have two options:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Enable Record Mode on the ScreenshotRule:")," Apply necessary settings to the ScreenshotRule in Kotlin.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-kotlin"},"@get:Rule val rule = ScreenshotRule(TestActivity::class.java)\n\n@ScreenshotInstrumentation\n@Test\nfun default() {\n    rule\n        .setRecordModeEnabled(true)\n        .assertSame()\n}\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Enable the Testify Gradle Setting:")," Enable record mode in the ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")," file:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"testify {\n    recordMode true\n}\n")),(0,i.kt)("p",null,"Once again, due to the specific Gradle task requirement, the ",(0,i.kt)("inlineCode",{parentName:"p"},"screenshotPull")," task cannot be used. After execution, navigate to the module's ",(0,i.kt)("inlineCode",{parentName:"p"},"build/outputs/managed_device_android_test_additional_output/")," folder and copy the recorded baseline into a folder named after your device configuration inside ",(0,i.kt)("inlineCode",{parentName:"p"},"androidTest/assets/screenshots/")," directory."),(0,i.kt)("h2",{id:"happy-testing"},"Happy Testing"),(0,i.kt)("p",null,"With these updates in place, you're now set to harness the potential of Gradle Managed Devices in Android Testify for enhanced screenshot tests."),(0,i.kt)("p",null,"We're excited to see how this enhancement elevates your UI testing process with Android Testify. "),(0,i.kt)("p",null,"This feature is still in beta, so please let us know if you have any questions or need further assistance in implementing this feature, feel free to reach out! Happy testing!"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/tagged/android-testify"},"Stack Overflow")," | ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ndtp/android-testify/issues"},"GitHub Issues")),(0,i.kt)("hr",null))}g.isMDXComponent=!0}}]);